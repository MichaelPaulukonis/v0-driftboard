# PRD: Standalone Backup Script

This document outlines the requirements for a standalone script to create JSON backups of user data for Driftboard.

## 1. Executive Summary

The script will create a complete JSON backup of all board, list, card, and related data for a specified user. The primary value is to provide a reliable method for data inspection, ensure data integrity against bugs or model changes, and serve as a foundational step towards a future import/export feature. This script is an internal admin tool designed for rapid development, bypassing the core application UI.

## 2. Problem Statement

Currently, there is no straightforward way to manually export a complete snapshot of a user's data. While automated backups exist, a manual export capability is needed for developer peace of mind, data portability, and easier debugging. This addresses the risk of data corruption due to bugs or schema changes and fulfills the philosophical goal of user data ownership.

## 3. Product Vision & Goals

**Long-Term Vision:**
The script is the first step towards a comprehensive import/export system within Driftboard. The long-term vision includes the ability to import data to restore backups or scaffold new environments with test data. It will also be part of a larger suite of admin scripts designed to ensure safe and repeatable database operations, discouraging direct database manipulation.

**Key Objectives (MVP):**
- Create a runnable script that takes a User ID and generates a backup.
- The output must be a single, valid JSON file containing all specified user data.
- The process must be reliable and provide clear feedback to the operator.

## 4. Target Users & Personas

**Primary Persona:** Developer/Admin (specifically, the project owner).

**Persona Goals:**
- To quickly and safely obtain a complete backup of a user's data.
- To have a local copy of data for analysis and testing.

**User Journey (MVP):**
1.  The admin opens a terminal in the project's root directory.
2.  They run the script, passing the target user's Firebase UID as an argument (e.g., `npx ts-node scripts/backup.ts --user <userID>`).
3.  The script prints status messages to the console, indicating connection status, data fetching progress (board-by-board), and the final file path.
4.  A single JSON file named `backup.<userID>.<timestamp>.json` is created in the gitignored `/exports` directory.
5.  The script exits with a success or error message.

## 5. Functional Requirements

**Core Features (MVP):**
- The script must back up the following collections for the specified user: `boards`, `lists`, `cards`, `comments`, `deleted`, `archived`, and `done`.
- The user will be identified by their Firebase Authentication UID.
- The output file will be named using the format: `backup.${userID}.${yyyyMMddhhmmss}.json`.
- The file will be saved in an `exports/` directory at the project root, which should be included in `.gitignore`.

**User Story (MVP):**
- **As a** Developer/Admin,
- **I want to** run a single command with a user ID,
- **so that** a complete JSON backup of all their associated data is saved to a local file.

**Acceptance Criteria:**
- The script accepts a `--user` argument with a Firebase UID.
- The script successfully fetches all specified collections related to that UID.
- The script outputs a single, correctly named JSON file to the `/exports` directory.
- The script logs its progress and a final success or failure message to the console.

## 6. Technical Requirements

- **Platform:** The script will be written in TypeScript and executed with Node.js.
- **Authentication:** It will use the Firebase Admin SDK, authenticating via a local service account key JSON file.
- **Dependencies:** It will use the `commander` library to parse command-line arguments.
- **Performance:** For the MVP, the entire dataset for a user will be fetched into memory before being written to the file. Streaming is not required at this stage.

## 7. Design & UX Considerations

- **CLI Interface:** The script should have a simple and clear command-line interface, managed by `commander`.
- **Console Output:** The script must provide verbose, real-time feedback, including connection status, which collections are being fetched, and board-by-board progress. This can be simplified in future versions.
- **Error Handling:** The script must handle errors gracefully (e.g., invalid User ID, database connection failure) and provide specific, helpful error messages.
- **Configuration:** For the MVP, the path to the service account key and the output directory will be hard-coded. The User ID must be a required parameter.

## 8. Timeline & Milestones

- **Phase 1 (Setup):** Initialize the `scripts/backup.ts` file, add `commander` as a dependency, and configure the Firebase Admin SDK connection.
- **Phase 2 (Data Fetching):** Implement the logic to fetch all required collections based on the provided User ID.
- **Phase 3 (File Writing & Logging):** Structure the fetched data into a single JSON object and write it to the correctly named file, implementing verbose console logging.
- **Phase 4 (Finalization):** Implement robust error handling and polish the CLI output for clarity.

## 9. Assumptions & Constraints

**Assumptions:**
- A valid Firebase service account key file is present in a known, gitignored location.
- The script will be executed from the project's root directory.
- A user's entire dataset is small enough to fit comfortably in memory.
- The data schema has no circular dependencies that would complicate fetching.

**Constraints:**
- The script must be written in TypeScript.
- It is a command-line tool and will not have a graphical interface.
- The MVP will only support backing up a single user at a time.
- The output format is strictly a single JSON file.
